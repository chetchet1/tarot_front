import{s as a}from"./index-kbC3-w1S.js";const i=["celtic_cross","seven_star","cup_of_relationship"];function u(){const e=new Date,r=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${r}-${t}-${s}`}async function o(){const{data:{user:e}}=await a.auth.getUser();return(e==null?void 0:e.id)||null}async function c(){console.log("ğŸ“Š [hasUsedPremiumSpreadToday] í˜¸ì¶œë¨");try{const e=await o();if(console.log("ğŸ“Š [hasUsedPremiumSpreadToday] userId:",e),!e)return console.warn("ì‚¬ìš©ì IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),!1;const r=u();console.log("ğŸ“Š [hasUsedPremiumSpreadToday] today:",r);const{data:t,error:s}=await a.from("premium_spread_usage").select("id, spread_id").eq("user_id",e).gte("used_at",`${r}T00:00:00`).lt("used_at",`${r}T23:59:59`);if(console.log("ğŸ“Š [hasUsedPremiumSpreadToday] DB ê²°ê³¼:",{data:t,error:s}),s&&s.code!=="PGRST116")return console.error("ìœ ë£Œ ë°°ì—´ ì‚¬ìš© í™•ì¸ ì˜¤ë¥˜:",s),!1;const n=!!(t&&t.length>0);return console.log("ğŸ“Š [hasUsedPremiumSpreadToday] ê²°ê³¼:",n),n}catch(e){return console.error("ìœ ë£Œ ë°°ì—´ ì‚¬ìš© í™•ì¸ ì¤‘ ì˜¤ë¥˜:",e),!1}}function d(e){return i.includes(e)}async function f(e,r){return r||!d(e)?!0:!await c()}async function _(e){if(d(e))try{const r=await o();if(!r){console.error("ì‚¬ìš©ì IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}const{error:t}=await a.from("premium_spread_usage").insert({user_id:r,spread_id:e,used_at:new Date().toISOString()});t&&console.error("ìœ ë£Œ ë°°ì—´ ì‚¬ìš© ê¸°ë¡ ì˜¤ë¥˜:",t)}catch(r){console.error("ìœ ë£Œ ë°°ì—´ ì‚¬ìš© ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:",r)}}async function l(){try{const e=await o();if(!e)return null;const r=u(),{data:t,error:s}=await a.from("premium_spread_usage").select("spread_id").eq("user_id",e).gte("used_at",`${r}T00:00:00`).lt("used_at",`${r}T23:59:59`);return s&&s.code!=="PGRST116"?(console.error("ì‚¬ìš©í•œ ìœ ë£Œ ë°°ì—´ ì¡°íšŒ ì˜¤ë¥˜:",s),null):t&&t.length>0?t[0].spread_id:null}catch(e){return console.error("ì‚¬ìš©í•œ ìœ ë£Œ ë°°ì—´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:",e),null}}async function g(){if(await c()){const r=await l();return`ì˜¤ëŠ˜ì˜ ë¬´ë£Œ ìœ ë£Œ ë°°ì—´ì„ ì´ë¯¸ ì‚¬ìš©í•˜ì…¨ìŠµë‹ˆë‹¤. (${m(r)})
ë‚´ì¼ ë‹¤ì‹œ ì´ìš©í•˜ì‹œê±°ë‚˜ í”„ë¦¬ë¯¸ì—„ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ì„¸ìš”.`}return"ìœ ë£Œ ë°°ì—´(ì¼ˆí‹± í¬ë¡œìŠ¤, ì„¸ë¸ìŠ¤íƒ€, ì»µ ì˜¤ë¸Œ ë¦´ë ˆì´ì…˜ì‰½)ì€ í•˜ë£¨ 1íšŒ ë¬´ë£Œë¡œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤."}function m(e){return e?{celtic_cross:"ì¼ˆí‹± í¬ë¡œìŠ¤",seven_star:"ì„¸ë¸ìŠ¤íƒ€",cup_of_relationship:"ì»µ ì˜¤ë¸Œ ë¦´ë ˆì´ì…˜ì‰½"}[e]||e:""}export{f as canUsePremiumSpread,g as getFreeUserMessage,l as getUsedPremiumSpreadToday,c as hasUsedPremiumSpreadToday,d as isPremiumSpread,_ as recordPremiumSpreadUsage};
