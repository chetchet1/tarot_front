import{g as s}from"./index-DydaZsU0.js";const l=["celtic_cross","seven_star","cup_of_relationship"];function i(){const e=new Date,r=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${r}-${t}-${a}`}async function m(){const{data:{user:e}}=await s.auth.getUser();return(e==null?void 0:e.id)||null}async function u(){console.log("ğŸ“Š [hasUsedPremiumSpreadToday] í˜¸ì¶œë¨");try{const{data:{user:e}}=await s.auth.getUser(),r=(e==null?void 0:e.id)||null,t=e==null?void 0:e.email;if(console.log("ğŸ“Š [hasUsedPremiumSpreadToday] userId:",r,"email:",t),t==="test@example.com")return console.log("ğŸ“Š [hasUsedPremiumSpreadToday] í…ŒìŠ¤íŠ¸ ê³„ì • - ì œí•œ ì—†ìŒ"),!1;if(!r)return console.warn("ì‚¬ìš©ì IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),!1;const a=i();console.log("ğŸ“Š [hasUsedPremiumSpreadToday] today:",a);const{data:o,error:n}=await s.from("premium_spread_usage").select("id, spread_id").eq("user_id",r).gte("used_at",`${a}T00:00:00`).lt("used_at",`${a}T23:59:59`);if(console.log("ğŸ“Š [hasUsedPremiumSpreadToday] DB ê²°ê³¼:",{data:o,error:n}),n&&n.code!=="PGRST116")return console.error("ìœ ë£Œ ë°°ì—´ ì‚¬ìš© í™•ì¸ ì˜¤ë¥˜:",n),!1;const c=!!(o&&o.length>0);return console.log("ğŸ“Š [hasUsedPremiumSpreadToday] ê²°ê³¼:",c),c}catch(e){return console.error("ìœ ë£Œ ë°°ì—´ ì‚¬ìš© í™•ì¸ ì¤‘ ì˜¤ë¥˜:",e),!1}}function d(e){return l.includes(e)}async function _(e,r){if(r)return!0;const{data:{user:t}}=await s.auth.getUser();return(t==null?void 0:t.email)==="test@example.com"?(console.log("ğŸ“Š [canUsePremiumSpread] í…ŒìŠ¤íŠ¸ ê³„ì • - ëª¨ë“  ë°°ì—´ ì‚¬ìš© ê°€ëŠ¥"),!0):d(e)?!await u():!0}async function S(e){if(d(e))try{const{data:{user:r}}=await s.auth.getUser(),t=(r==null?void 0:r.id)||null;if((r==null?void 0:r.email)==="test@example.com"){console.log("ğŸ“Š [recordPremiumSpreadUsage] í…ŒìŠ¤íŠ¸ ê³„ì • - ì‚¬ìš© ê¸°ë¡ ê±´ë„ˆëœ€");return}if(!t){console.error("ì‚¬ìš©ì IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}const{error:o}=await s.from("premium_spread_usage").insert({user_id:t,spread_id:e,used_at:new Date().toISOString()});o&&console.error("ìœ ë£Œ ë°°ì—´ ì‚¬ìš© ê¸°ë¡ ì˜¤ë¥˜:",o)}catch(r){console.error("ìœ ë£Œ ë°°ì—´ ì‚¬ìš© ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:",r)}}async function p(){try{const e=await m();if(!e)return null;const r=i(),{data:t,error:a}=await s.from("premium_spread_usage").select("spread_id").eq("user_id",e).gte("used_at",`${r}T00:00:00`).lt("used_at",`${r}T23:59:59`);return a&&a.code!=="PGRST116"?(console.error("ì‚¬ìš©í•œ ìœ ë£Œ ë°°ì—´ ì¡°íšŒ ì˜¤ë¥˜:",a),null):t&&t.length>0?t[0].spread_id:null}catch(e){return console.error("ì‚¬ìš©í•œ ìœ ë£Œ ë°°ì—´ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:",e),null}}async function h(){if(await u()){const r=await p();return`ì˜¤ëŠ˜ì˜ ë¬´ë£Œ ìœ ë£Œ ë°°ì—´ì„ ì´ë¯¸ ì‚¬ìš©í•˜ì…¨ìŠµë‹ˆë‹¤. (${g(r)})
ë‚´ì¼ ë‹¤ì‹œ ì´ìš©í•˜ì‹œê±°ë‚˜ í”„ë¦¬ë¯¸ì—„ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ì„¸ìš”.`}return"ìœ ë£Œ ë°°ì—´(ì¼ˆí‹± í¬ë¡œìŠ¤, ì„¸ë¸ìŠ¤íƒ€, ì»µ ì˜¤ë¸Œ ë¦´ë ˆì´ì…˜ì‰½)ì€ í•˜ë£¨ 1íšŒ ë¬´ë£Œë¡œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤."}function g(e){return e?{celtic_cross:"ì¼ˆí‹± í¬ë¡œìŠ¤",seven_star:"ì„¸ë¸ìŠ¤íƒ€",cup_of_relationship:"ì»µ ì˜¤ë¸Œ ë¦´ë ˆì´ì…˜ì‰½"}[e]||e:""}export{_ as canUsePremiumSpread,h as getFreeUserMessage,p as getUsedPremiumSpreadToday,u as hasUsedPremiumSpreadToday,d as isPremiumSpread,S as recordPremiumSpreadUsage};
