# 250828-5 비밀번호 재설정 - 최종 해결

## 🔍 핵심 문제 파악
**딥링크로 앱을 열면 앱 내부 WebView(localhost)에서 페이지를 보게 됨**
- 이것이 localhost 문제의 근본 원인!

## ✅ 올바른 해결책

### 이메일 링크 동작 방식
1. **앱에서 비밀번호 찾기** → 이메일 전송
2. **이메일 링크 클릭** → **웹 브라우저에서 Vercel 페이지 열림** (앱이 아닌)
3. **웹에서 비밀번호 변경** → 완료
4. **"타로의 정원 앱 열기"** 버튼으로 앱 복귀

### 코드 수정
```javascript
// 앱이든 웹이든 모두 Vercel URL로 전송
const PRODUCTION_URL = 'https://tarot-app-psi-eight.vercel.app';

if (window.location.hostname === 'localhost' && !Capacitor.isNativePlatform()) {
  // 로컬 브라우저 테스트용만
  redirectUrl = `${window.location.origin}/auth/reset-password`;
} else {
  // 앱 또는 프로덕션 - 모두 Vercel URL 사용
  redirectUrl = `${PRODUCTION_URL}/auth/reset-password`;
}
```

## 📱 작동 흐름

### 앱 사용자
1. 앱에서 "비밀번호를 잊으셨나요?" 클릭
2. 이메일 입력
3. 이메일 수신: `https://tarot-app-psi-eight.vercel.app/auth/reset-password#token=...`
4. **링크 클릭 → 웹 브라우저(Chrome 등)에서 열림**
5. 비밀번호 변경
6. 완료 → "타로의 정원 앱 열기" 버튼
7. 앱으로 복귀 → 로그인

### 웹 사용자  
1. 동일한 Vercel URL로 접속
2. 비밀번호 변경
3. 완료 → Play Store 안내

## ⚠️ Supabase 설정 필요

**Authentication → URL Configuration → Redirect URLs:**
```
https://tarot-app-psi-eight.vercel.app/auth/reset-password
http://localhost:8082/auth/reset-password  (개발용)
```

**중요: 딥링크(com.tarotgarden.app://)는 제거!**

## 🎯 이점
- localhost 문제 완전 해결
- 앱/웹 구분 없이 동일한 경험
- 웹 브라우저에서 안전하게 처리
- 완료 후 앱으로 돌아가는 명확한 안내

## 테스트 체크리스트
- [ ] 앱에서 비밀번호 찾기 요청
- [ ] 이메일 링크가 Vercel URL인지 확인
- [ ] 링크 클릭 시 웹 브라우저에서 열리는지 확인
- [ ] 비밀번호 변경 완료
- [ ] "앱 열기" 버튼으로 앱 복귀 확인