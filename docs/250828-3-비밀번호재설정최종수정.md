# 250828-3 비밀번호 재설정 최종 수정

## 작업 날짜
2025년 8월 28일

## 수정 사항

### 1. 라우터 가드 수정
- `/auth/reset-password` 경로를 허용된 경로에 추가
- 웹 배포 환경에서도 비밀번호 재설정 페이지 접속 가능

### 2. PasswordReset.vue 개선
**웹 환경 감지 및 처리:**
- 웹 환경과 앱 환경 구분
- 웹에서 완료 시 앱 다운로드/열기 안내
- 딥링크로 앱 열기 시도 (com.tarotgarden.app://)
- 앱이 없으면 Play Store로 자동 이동

**UI 개선:**
- 웹 환경: "타로의 정원 앱 열기" + "Play Store에서 설치" 버튼
- 앱 환경: 기존처럼 카운트다운 후 로그인 페이지로 이동

### 3. authService.resetPassword 수정
**동적 URL 설정:**
```javascript
// 환경별 리다이렉트 URL 설정
- Vercel 배포: https://도메인/auth/reset-password
- 로컬 개발: http://localhost:8082/auth/reset-password  
- 앱 환경: com.tarotgarden.app://auth/reset-password
```

### 4. AndroidManifest.xml
- 비밀번호 재설정 인텐트 필터 추가 완료
- `com.tarotgarden.app://auth/reset-password` 스킴 지원

## ⚠️ 중요: Supabase 대시보드 설정

### 필수 설정 (수동 작업 필요)

1. **Supabase 대시보드 로그인**

2. **Authentication → URL Configuration 설정:**
   - Site URL: `https://tarot-app-psi-eight.vercel.app` (또는 배포된 Vercel URL)
   - Redirect URLs에 모두 추가:
     ```
     https://tarot-app-psi-eight.vercel.app/auth/reset-password
     com.tarotgarden.app://auth/reset-password
     http://localhost:8082/auth/reset-password
     ```

3. **Authentication → Email Templates → Reset Password:**
   - 기본 템플릿의 URL 부분을 확인
   - `{{ .ConfirmationURL }}`이 올바르게 설정되어 있는지 확인

## 작동 방식

### 앱에서 사용 시:
1. 비밀번호 찾기 → 이메일 입력
2. 이메일로 `com.tarotgarden.app://auth/reset-password#token=...` 링크 전송
3. 링크 클릭 → 앱이 열리면서 비밀번호 재설정 페이지로 이동
4. 새 비밀번호 입력 → 완료 → 로그인 페이지로 이동

### 웹에서 접속 시:
1. 이메일의 링크가 웹 브라우저로 열림
2. 비밀번호 변경 완료
3. "타로의 정원 앱 열기" 버튼으로 앱 실행
4. 앱이 없으면 Play Store로 자동 이동

## 테스트 방법

### 로컬 테스트:
```bash
npm run dev
# 비밀번호 찾기 → 이메일 입력
# 받은 이메일의 URL을 localhost:8082로 변경하여 접속
```

### 프로덕션 테스트:
1. 앱 빌드: `npm run build:cap`
2. Android 동기화: `npx cap sync android`
3. APK 생성 및 설치
4. 실제 이메일로 테스트

## Git 커밋
- 모든 수정사항 커밋 예정